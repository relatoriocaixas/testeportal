<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Unificado v2</title>
  <link rel="stylesheet" href="style.css">
  <script type="module" src="firebaseConfig.js"></script>
  <script type="module" src="avisos.js"></script>
</head>
<body>
  <div class="app">
    <div id="sidebar" class="sidebar">
      <div class="toggle">☰</div>
      <div class="user-info">
        <div id="userName">Usuário</div>
        <div id="userMat">0000</div>
      </div>
      <ul>
        <li data-target="home">🏠 Home</li>
        <li data-target="abastecimento">💵 Abastecimento</li>
        <li data-target="emprestimo">💳 Empréstimo</li>
        <li data-target="relatorios">📊 Relatórios</li>
        <li data-target="diferencas">📉 Diferenças</li>
      </ul>
      <button id="logoutBtn">Sair</button>
    </div>

    <div class="main-content">
      <div class="topbar" style="display:flex;align-items:center;justify-content:flex-end;padding:8px 16px"></div>
      
      <div id="avisosSection" class="avisos">
        <div style="text-align:center;margin-bottom:8px;">
          <img src="assets/logo.png" alt="Movebuss" style="max-height:88px;filter:drop-shadow(0 0 6px rgba(192,192,192,0.25));">
        </div>
        <h2>Avisos Recebedoria (<span id="dataVigente"></span>)</h2>
        <div id="avisosControls" style="text-align:right;margin-bottom:8px;"></div>
        <ul id="avisosList"></ul>
      </div>

      <div class="iframe-container" id="iframeContainer">
        <iframe id="mainFrame" src=""></iframe>
      </div>
    </div>
  </div>

  <script type="module">
    const sidebar = document.getElementById('sidebar');
    const toggle = sidebar.querySelector('.toggle');
    const mainContent = document.querySelector('.main-content');

    toggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      if(sidebar.classList.contains('open')) {
        mainContent.style.marginLeft = '220px';
      } else {
        mainContent.style.marginLeft = '70px';
      }
    });

    // Atualiza usuário na sidebar
    import { auth } from './firebaseConfig.js';
    auth.onAuthStateChanged(user => {
      const userName = document.getElementById('userName');
      const userMat = document.getElementById('userMat');
      if(user) {
        const mat = user.email ? user.email.split('@')[0] : '???';
        userName.textContent = mat; // Aqui você pode usar currentUserDoc.nome se carregar do Firestore
        userMat.textContent = mat;
      }
    });
  </script>
</body>
</html>
